<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Color Shake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }

    h1 {
      margin-top: 10px;
    }

    .game {
      padding: 16px;
    }

    .colors {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 16px 0;
    }

    input[type="color"] {
      width: 70px;
      height: 70px;
      border: none;
      background: none;
    }

    .circle {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      margin: 16px auto;
      background: #444;
      border: 4px solid #fff;
    }

    button {
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      margin: 8px;
    }

    .target {
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.8;
    }

    .success {
      color: #4caf50;
      font-size: 18px;
      margin-top: 10px;
    }

    .fail {
      color: #f44336;
      font-size: 18px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="game">
    <h1>ðŸŽ¨ Color Shake</h1>
    <div>Level <span id="level">1</span></div>

    <div class="colors" id="colorInputs"></div>

    <div class="circle" id="mixed"></div>
    <div class="circle" id="target"></div>

    <div class="target">Match the target color</div>

    <button onclick="mix()">Mix (or Shake)</button>

    <div id="result"></div>
  </div>

<script>
let level = 1;
let targetColor = {};
let lastShake = 0;

function randColor() {
  return {
    r: Math.floor(Math.random() * 256),
    g: Math.floor(Math.random() * 256),
    b: Math.floor(Math.random() * 256)
  };
}

function rgbToHex({ r, g, b }) {
  return `#${[r,g,b].map(v => v.toString(16).padStart(2,'0')).join("")}`;
}

function hexToRgb(hex) {
  const n = parseInt(hex.slice(1), 16);
  return {
    r: (n >> 16) & 255,
    g: (n >> 8) & 255,
    b: n & 255
  };
}

function setupLevel() {
  document.getElementById("level").textContent = level;
  document.getElementById("result").textContent = "";

  const inputs = document.getElementById("colorInputs");
  inputs.innerHTML = "";

  let colorCount = level < 20 ? 2 : level < 60 ? 3 : 3;

  for (let i = 0; i < colorCount; i++) {
    const input = document.createElement("input");
    input.type = "color";
    input.value = rgbToHex(randColor());
    inputs.appendChild(input);
  }

  targetColor = randColor();
  document.getElementById("target").style.background = rgbToHex(targetColor);
  document.getElementById("mixed").style.background = "#444";
}

function mix() {
  const inputs = document.querySelectorAll("input[type=color]");
  let sum = { r: 0, g: 0, b: 0 };

  inputs.forEach(input => {
    const rgb = hexToRgb(input.value);
    sum.r += rgb.r;
    sum.g += rgb.g;
    sum.b += rgb.b;
  });

  const mixed = {
    r: Math.round(sum.r / inputs.length),
    g: Math.round(sum.g / inputs.length),
    b: Math.round(sum.b / inputs.length)
  };

  document.getElementById("mixed").style.background = rgbToHex(mixed);
  check(mixed);
}

function diff(a, b) {
  return Math.abs(a.r - b.r) + Math.abs(a.g - b.g) + Math.abs(a.b - b.b);
}

function check(mixed) {
  let tolerance = level < 20 ? 120 : level < 60 ? 80 : 50;

  if (diff(mixed, targetColor) <= tolerance) {
    document.getElementById("result").innerHTML =
      `<div class="success">âœ” Level Complete</div>`;
    level++;
    setTimeout(setupLevel, 800);
  } else {
    document.getElementById("result").innerHTML =
      `<div class="fail">âœ– Try Again</div>`;
  }
}

// Shake detection
if (window.DeviceMotionEvent) {
  window.addEventListener("devicemotion", e => {
    const a = e.accelerationIncludingGravity;
    if (!a) return;

    const strength = Math.abs(a.x) + Math.abs(a.y) + Math.abs(a.z);
    const now = Date.now();

    if (strength > 30 && now - lastShake > 900) {
      mix();
      lastShake = now;
    }
  });
}

setupLevel();
</script>
</body>
</html>
